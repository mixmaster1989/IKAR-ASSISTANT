# üé® –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –û–ë–†–ê–ë–û–¢–ö–ò –§–û–¢–û–ì–†–ê–§–ò–ô –í –õ–ò–ß–ù–´–• –°–û–û–ë–©–ï–ù–ò–Ø–•

## üìã –ü—Ä–æ–±–ª–µ–º–∞

–û–±–Ω–∞—Ä—É–∂–µ–Ω–∞ **–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è —Ä–∞–∑–Ω–∏—Ü–∞** –≤ –æ–±—Ä–∞–±–æ—Ç–∫–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –º–µ–∂–¥—É –≥—Ä—É–ø–ø–∞–º–∏ –∏ –ª–∏—á–Ω—ã–º–∏ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏:

### **–í –≥—Ä—É–ø–ø–∞—Ö (–ø—Ä–∞–≤–∏–ª—å–Ω–æ):**
- ‚úÖ –ù–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç —Å –∫–Ω–æ–ø–∫–∞–º–∏ –≤—ã–±–æ—Ä–∞
- ‚úÖ –î–≤–∞ –≤–∞—Ä–∏–∞–Ω—Ç–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏: "–†–∞—Å–ø–æ–∑–Ω–∞—Ç—å –∫–∞–∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ" –∏ "–†–∞—Å–ø–æ–∑–Ω–∞—Ç—å –∫–∞–∫ —Ç–µ–∫—Å—Ç"
- ‚úÖ –§–æ—Ç–æ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –ë–î –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–µ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏
- ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç —Ç–∏–ø –æ–±—Ä–∞–±–æ—Ç–∫–∏

### **–í –ª–∏—á–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏—è—Ö (—Å—Ç–∞—Ä—ã–π –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç):**
- ‚ùå –ü—Ä—è–º–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –±–µ–∑ –≤—ã–±–æ—Ä–∞
- ‚ùå –¢–æ–ª—å–∫–æ –∫—Ä–∏–ø—Ç–æ-–∞–Ω–∞–ª–∏–∑
- ‚ùå –ù–µ—Ç –∫–Ω–æ–ø–æ–∫ –≤—ã–±–æ—Ä–∞
- ‚ùå –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ä–æ–π –ª–æ–≥–∏–∫–∏

## üîç –ê–Ω–∞–ª–∏–∑ —Ä–∞–∑–ª–∏—á–∏–π

### **–ö–æ–¥ –≤ –≥—Ä—É–ø–ø–∞—Ö (telegram_polling.py):**
```python
# –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π –≤ –≥—Ä—É–ø–ø–µ - —Ç–µ–ø–µ—Ä—å —Ç–æ–ª—å–∫–æ –ø–æ –∫–Ω–æ–ø–∫–µ!
elif "photo" in message:
    # –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ñ–æ—Ç–æ –≤ –ë–î
    sqlite_storage.save_pending_photo(chat_id, message_id, user_id, message_dict, timestamp)
    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏ –≤—ã–±–æ—Ä–∞
    await send_photo_recognition_buttons(chat_id, message_id)
```

### **–ö–æ–¥ –≤ –ª–∏—á–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏—è—Ö (telegram_private.py) - –î–û –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
```python
# –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π –≤ –ø—Ä–∏–≤–∞—Ç–Ω—ã—Ö —á–∞—Ç–∞—Ö
elif "photo" in message:
    # –ü—Ä—è–º–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –±–µ–∑ –≤—ã–±–æ—Ä–∞
    await process_telegram_photo_with_crypto_detection(message, chat_id, user_id, temp_dir, download_telegram_file, send_telegram_message)
```

## üõ†Ô∏è –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

### **–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ `backend/api/telegram_private.py`:**

1. **–î–æ–±–∞–≤–ª–µ–Ω—ã –∏–º–ø–æ—Ä—Ç—ã:**
```python
from backend.api.telegram_photo_handler import send_photo_recognition_buttons
from backend.memory.sqlite import sqlite_storage
from datetime import datetime
```

2. **–ò–∑–º–µ–Ω–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π:**
```python
# –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π –≤ –ø—Ä–∏–≤–∞—Ç–Ω—ã—Ö —á–∞—Ç–∞—Ö - —Ç–µ–ø–µ—Ä—å —Å –∫–Ω–æ–ø–∫–∞–º–∏ –∫–∞–∫ –≤ –≥—Ä—É–ø–ø–∞—Ö!
elif "photo" in message:
    logger.info(f"üì∑ –ü–æ–ª—É—á–µ–Ω–æ —Ñ–æ—Ç–æ –æ—Ç {chat_id}")
    from_user = message.get("from", {}).get("id", "")
    message_id = message.get("message_id", 0)
    ts = message.get("date", int(datetime.now().timestamp()))
    
    # –°–æ—Ö—Ä–∞–Ω—è–µ–º –∑–∞–ø–∏—Å—å –æ —Ñ–æ—Ç–æ –≤ –ë–î
    sqlite_storage.save_group_message(
        chat_id=chat_id,
        message_id=message_id,
        user_id=str(from_user),
        msg_type="photo",
        content="[photo]",
        timestamp=ts
    )
    
    # –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ñ–æ—Ç–æ –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–µ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏
    sqlite_storage.save_pending_photo(
        chat_id=chat_id,
        message_id=message_id,
        user_id=str(from_user),
        message_dict=message,
        timestamp=ts
    )
    
    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏ –≤—ã–±–æ—Ä–∞ —Ç–∏–ø–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏
    await send_photo_recognition_buttons(chat_id, message_id)
```

## üéØ –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å

### **–î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
```
üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ñ–æ—Ç–æ –≤ –ª–∏—á–∫—É

ü§ñ –ë–æ—Ç: [–°—Ä–∞–∑—É –Ω–∞—á–∏–Ω–∞–µ—Ç –∫—Ä–∏–ø—Ç–æ-–∞–Ω–∞–ª–∏–∑]
     "üîç –ê–Ω–∞–ª–∏–∑–∏—Ä—É—é –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ..."
     "üí∞ –≠—Ç–æ –≥—Ä–∞—Ñ–∏–∫ BTC/USDT..."
```

### **–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
```
üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ñ–æ—Ç–æ –≤ –ª–∏—á–∫—É

ü§ñ –ë–æ—Ç: "–ß—Ç–æ —Å–¥–µ–ª–∞—Ç—å —Å —ç—Ç–∏–º —Ñ–æ—Ç–æ?"
     [–ö–Ω–æ–ø–∫–∞] "–†–∞—Å–ø–æ–∑–Ω–∞—Ç—å –∫–∞–∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ"
     [–ö–Ω–æ–ø–∫–∞] "–†–∞—Å–ø–æ–∑–Ω–∞—Ç—å –∫–∞–∫ —Ç–µ–∫—Å—Ç"

üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç —Ç–∏–ø –æ–±—Ä–∞–±–æ—Ç–∫–∏

ü§ñ –ë–æ—Ç: [–í—ã–ø–æ–ª–Ω—è–µ—Ç –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Ç–∏–ø –∞–Ω–∞–ª–∏–∑–∞]
```

## üîÑ –ü–æ–ª–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏

### **–ù–æ–≤—ã–π –ø–æ—Ç–æ–∫ –≤ –ª–∏—á–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏—è—Ö:**

1. **–ü–æ–ª—É—á–µ–Ω–∏–µ —Ñ–æ—Ç–æ** ‚Üí Telegram –ø–æ–ª—É—á–∞–µ—Ç —Ñ–æ—Ç–æ –≤ –ª–∏—á–∫—É
2. **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î** ‚Üí `save_pending_photo()` —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ñ–æ—Ç–æ
3. **–û—Ç–ø—Ä–∞–≤–∫–∞ –∫–Ω–æ–ø–æ–∫** ‚Üí `send_photo_recognition_buttons()` –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤—ã–±–æ—Ä
4. **–í—ã–±–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è** ‚Üí –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç –∫–Ω–æ–ø–∫—É
5. **–û–±—Ä–∞–±–æ—Ç–∫–∞ callback** ‚Üí `handle_photo_callback()` –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤—ã–±–æ—Ä
6. **–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∞–Ω–∞–ª–∏–∑–∞** ‚Üí –í—ã–±—Ä–∞–Ω–Ω—ã–π —Ç–∏–ø –æ–±—Ä–∞–±–æ—Ç–∫–∏ (–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ/—Ç–µ–∫—Å—Ç/–∫—Ä–∏–ø—Ç–æ)
7. **–û—Ç–ø—Ä–∞–≤–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞** ‚Üí –†–µ–∑—É–ª—å—Ç–∞—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

## üé® –î–æ—Å—Ç—É–ø–Ω—ã–µ —Ç–∏–ø—ã –æ–±—Ä–∞–±–æ—Ç–∫–∏

### **1. üîç –†–∞—Å–ø–æ–∑–Ω–∞—Ç—å –∫–∞–∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ:**
- –ê–Ω–∞–ª–∏–∑ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
- –û–ø–∏—Å–∞–Ω–∏–µ —Ç–æ–≥–æ, —á—Ç–æ –≤–∏–¥–Ω–æ –Ω–∞ –∫–∞—Ä—Ç–∏–Ω–∫–µ
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `process_telegram_photo_with_crypto_detection()`

### **2. üìù –†–∞—Å–ø–æ–∑–Ω–∞—Ç—å –∫–∞–∫ —Ç–µ–∫—Å—Ç:**
- OCR —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–∏
- –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –≤—Å–µ—Ö —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —á–∏—Å—Ç—ã–π —Ç–µ–∫—Å—Ç –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON

### **3. üí∞ –ö—Ä–∏–ø—Ç–æ-–∞–Ω–∞–ª–∏–∑ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏):**
- –ï—Å–ª–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω –∫—Ä–∏–ø—Ç–æ–∫–æ–Ω—Ç–µ–Ω—Ç –≤ –æ–ø–∏—Å–∞–Ω–∏–∏
- –ê–Ω–∞–ª–∏–∑ —Ç–æ—Ä–≥–æ–≤—ã—Ö –≥—Ä–∞—Ñ–∏–∫–æ–≤
- –ü–æ–ª—É—á–µ–Ω–∏–µ —Ä—ã–Ω–æ—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

## üìä –£–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞

### **–¢–µ–ø–µ—Ä—å –æ–¥–∏–Ω–∞–∫–æ–≤–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤:**
- ‚úÖ –ì—Ä—É–ø–ø–∞—Ö
- ‚úÖ –°—É–ø–µ—Ä–≥—Ä—É–ø–ø–∞—Ö  
- ‚úÖ –õ–∏—á–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏—è—Ö

### **–û–¥–∏–Ω–∞–∫–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**
- ‚úÖ –ö–Ω–æ–ø–∫–∏ –≤—ã–±–æ—Ä–∞ —Ç–∏–ø–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ñ–æ—Ç–æ –≤ –ë–î
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ callback'–æ–≤
- ‚úÖ –í—Å–µ —Ç–∏–ø—ã –∞–Ω–∞–ª–∏–∑–∞

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### **–°–æ–∑–¥–∞–Ω —Ç–µ—Å—Ç `test/test_private_photo_buttons.py`:**
- ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∏–∑–º–µ–Ω–µ–Ω–∏–π
- ‚úÖ –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∏–º–ø–æ—Ä—Ç—ã
- ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ª–æ–≥–∏–∫—É –æ–±—Ä–∞–±–æ—Ç–∫–∏
- ‚úÖ –°—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç —Å –≥—Ä—É–ø–ø–æ–≤–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–æ–π

### **–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:**
```
üéâ –†–ï–ó–£–õ–¨–¢–ê–¢:
   ‚úÖ –ü—Ä–æ–±–ª–µ–º–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞!
   ‚úÖ –õ–∏—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É—é—Ç –Ω–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç
   ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –≤—ã–±–∏—Ä–∞—Ç—å —Ç–∏–ø –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ñ–æ—Ç–æ
   ‚úÖ –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å —É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω —Å –≥—Ä—É–ø–ø–∞–º–∏
```

## üéâ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

### **–£—Å–ø–µ—à–Ω–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:**
- ‚úÖ –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π –º–µ–∂–¥—É –≥—Ä—É–ø–ø–∞–º–∏ –∏ –ª–∏—á–Ω—ã–º–∏ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –∫–Ω–æ–ø–∫–∏ –≤—ã–±–æ—Ä–∞ —Ç–∏–ø–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤ –ª–∏—á–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏—è—Ö
- ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ñ–æ—Ç–æ –≤ –ë–î –¥–ª—è –ª–∏—á–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
- ‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è —Å–∏—Å—Ç–µ–º–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ callback'–æ–≤
- ‚úÖ –°–æ–∑–¥–∞–Ω —Ç–µ—Å—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏

### **–ö–ª—é—á–µ–≤–æ–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ:**
**–ü—Ä–æ–±–ª–µ–º–∞ —Å —Ä–∞–∑–Ω—ã–º–∏ —Ñ–æ—Ä–º–∞—Ç–∞–º–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ—à–µ–Ω–∞!** –¢–µ–ø–µ—Ä—å –∏ –≤ –≥—Ä—É–ø–ø–∞—Ö, –∏ –≤ –ª–∏—á–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏—è—Ö –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å –∫–Ω–æ–ø–∫–∞–º–∏ –≤—ã–±–æ—Ä–∞.

**üì∏ –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π —Ç–µ–ø–µ—Ä—å —É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–∞ –≤–æ –≤—Å–µ—Ö —Ç–∏–ø–∞—Ö —á–∞—Ç–æ–≤!** 