# üé® –ì—Ä—É–ø–ø–æ–≤–æ–π —Ç—Ä–∏–≥–≥–µ—Ä "–ë–û–¢–ù–ê–†–ò–°–£–ô"

## üìã **–ß—Ç–æ —ç—Ç–æ —Ç–∞–∫–æ–µ?**

–ù–æ–≤—ã–π —Ç—Ä–∏–≥–≥–µ—Ä –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –ø—Ä—è–º–æ –≤ –≥—Ä—É–ø–ø–∞—Ö Telegram. –†–∞–±–æ—Ç–∞–µ—Ç –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ —Ç—Ä–∏–≥–≥–µ—Ä—É "–ë–û–¢", –Ω–æ –≤–º–µ—Å—Ç–æ —Ç–µ–∫—Å—Ç–∞ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è.

## üöÄ **–ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å?**

### **–í –ª—é–±–æ–π –≥—Ä—É–ø–ø–µ –Ω–∞–ø–∏—à–∏—Ç–µ:**
```
–±–æ—Ç–Ω–∞—Ä–∏—Å—É–π –æ–ø–∏—Å–∞–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
```

### **–ü—Ä–∏–º–µ—Ä—ã:**
```
–±–æ—Ç–Ω–∞—Ä–∏—Å—É–π –∫–æ—Ç–∞ –Ω–∞ –∫—Ä—ã—à–µ
–±–æ—Ç–Ω–∞—Ä–∏—Å—É–π –∫—Ä–∞—Å–∏–≤—ã–π –∑–∞–∫–∞—Ç –Ω–∞–¥ –æ–∫–µ–∞–Ω–æ–º
–±–æ—Ç–Ω–∞—Ä–∏—Å—É–π –∫–∏–±–µ—Ä–ø–∞–Ω–∫ –≥–æ—Ä–æ–¥
–±–æ—Ç–Ω–∞—Ä–∏—Å—É–π —Ä–æ–±–æ—Ç–∞ –≤ –∫–æ—Å–º–æ—Å–µ
–±–æ—Ç–Ω–∞—Ä–∏—Å—É–π –¥—Ä–∞–∫–æ–Ω–∞ –∏ –∑–∞–º–æ–∫
```

## ‚öôÔ∏è **–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–∞–±–æ—Ç—ã:**

- **–¢—Ä–∏–≥–≥–µ—Ä**: —Å–ª–æ–≤–æ "–±–æ—Ç–Ω–∞—Ä–∏—Å—É–π" (–ª—é–±–æ–π —Ä–µ–≥–∏—Å—Ç—Ä)
- **Cooldown**: 2 –º–∏–Ω—É—Ç—ã –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏ –≤ –≥—Ä—É–ø–ø–µ
- **–ê–≤—Ç–æ–ø–µ—Ä–µ–≤–æ–¥**: –ø—Ä–æ–º–ø—Ç—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–≤–æ–¥—è—Ç—Å—è –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–∏–π
- **–ú–æ–¥–µ–ª—å**: –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è "Deliberate" –¥–ª—è –ª—É—á—à–µ–≥–æ –∫–∞—á–µ—Å—Ç–≤–∞
- **–†–∞–∑–º–µ—Ä**: 512x512 –ø–∏–∫—Å–µ–ª–µ–π
- **–®–∞–≥–∏**: 25 (—Ö–æ—Ä–æ—à–µ–µ –∫–∞—á–µ—Å—Ç–≤–æ)
- **–¢–∞–π–º–∞—É—Ç**: 5 –º–∏–Ω—É—Ç –Ω–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏—é

## üîß **–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:**

### **1. –§–∞–π–ª—ã:**
- `backend/api/group_image_trigger.py` - –æ—Å–Ω–æ–≤–Ω–æ–π –∫–æ–¥ —Ç—Ä–∏–≥–≥–µ—Ä–∞
- `backend/api/telegram.py` - —Ñ—É–Ω–∫—Ü–∏—è `send_telegram_photo()`
- `backend/api/telegram_polling.py` - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ polling

### **2. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:**
```
–°–æ–æ–±—â–µ–Ω–∏–µ –≤ –≥—Ä—É–ø–ø–µ ‚Üí –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç—Ä–∏–≥–≥–µ—Ä–∞ ‚Üí –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞ ‚Üí 
–ü–µ—Ä–µ–≤–æ–¥ –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–∏–π ‚Üí –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è ‚Üí –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ temp ‚Üí 
–û—Ç–ø—Ä–∞–≤–∫–∞ –≤ Telegram ‚Üí –ê–≤—Ç–æ—É–¥–∞–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–∞
```

### **3. –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã:**
```python
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç—Ä–∏–≥–≥–µ—Ä–∞
if "–±–æ—Ç–Ω–∞—Ä–∏—Å—É–π" in message.lower():
    # –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞
    prompt = extract_prompt(message)
    
    # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
    image_bytes = await image_generator(prompt)
    
    # –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ Telegram
    await send_telegram_photo(chat_id, image_path, caption)
```

## üìä **–°–∏—Å—Ç–µ–º–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:**

- **Cooldown**: –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∞–º
- **–í–∞–ª–∏–¥–∞—Ü–∏—è**: –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è —Ñ–∞–π–ª–æ–≤
- **–ê–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∞**: —É–¥–∞–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
- **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**: graceful handling –≤—Å–µ—Ö –∏—Å–∫–ª—é—á–µ–Ω–∏–π
- **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**: –ø–æ–¥—Ä–æ–±–Ω—ã–µ –ª–æ–≥–∏ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

## üß™ **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**

–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç:
```bash
python test_image_trigger.py
```

–¢–µ—Å—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç:
- ‚úÖ –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞
- ‚úÖ –ê–∫—Ç–∏–≤–∞—Ü–∏—é —Ç—Ä–∏–≥–≥–µ—Ä–∞
- ‚úÖ –°–∏—Å—Ç–µ–º—É cooldown
- ‚úÖ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

## üìù **–õ–æ–≥–∏:**

–í –ª–æ–≥–∞—Ö –∏—â–∏—Ç–µ:
```
[–ò–ó–û–ë–†–ê–ñ–ï–ù–ò–ï-–¢–†–ò–ì–ì–ï–†] –°—Ä–∞–±–æ—Ç–∞–ª —Ç—Ä–∏–≥–≥–µ—Ä –ø–æ —Å–ª–æ–≤—É '–±–æ—Ç–Ω–∞—Ä–∏—Å—É–π'
[–ò–ó–û–ë–†–ê–ñ–ï–ù–ò–ï-–¢–†–ò–ì–ì–ï–†] –ò–∑–≤–ª–µ—á–µ–Ω –ø—Ä–æ–º–ø—Ç: '–∫–æ—Ç–∞ –Ω–∞ –∫—Ä—ã—à–µ'
[–ò–ó–û–ë–†–ê–ñ–ï–ù–ò–ï-–¢–†–ò–ì–ì–ï–†] –ü–µ—Ä–µ–≤–µ–¥–µ–Ω–Ω—ã–π –ø—Ä–æ–º–ø—Ç: 'cat on the roof'
[–ò–ó–û–ë–†–ê–ñ–ï–ù–ò–ï-–¢–†–ò–ì–ì–ï–†] –ó–∞–ø—É—Å–∫ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è...
[–ò–ó–û–ë–†–ê–ñ–ï–ù–ò–ï-–¢–†–ò–ì–ì–ï–†] –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ: /tmp/chatumba_images/generated_123_456.png
[–ò–ó–û–ë–†–ê–ñ–ï–ù–ò–ï-–¢–†–ò–ì–ì–ï–†] –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ —á–∞—Ç 123
```

## üîß **–ù–∞—Å—Ç—Ä–æ–π–∫–∞:**

### **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≤ –∫–æ–¥–µ:**
```python
class GroupImageTrigger:
    def __init__(self):
        self.cooldown_sec = 120  # 2 –º–∏–Ω—É—Ç—ã
        self.trigger_word = "–±–æ—Ç–Ω–∞—Ä–∏—Å—É–π"
```

### **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏:**
```python
image_bytes = await image_generator(
    prompt=english_prompt,
    model="Deliberate",
    width=512,
    height=512,
    steps=25,
    cfg_scale=7.5,
    timeout=300
)
```

## üö® **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:**

### **–ï—Å–ª–∏ –ø—Ä–æ–º–ø—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω:**
```
üé® –î–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ñ–æ—Ä–º–∞—Ç:
**–±–æ—Ç–Ω–∞—Ä–∏—Å—É–π** [–æ–ø–∏—Å–∞–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è]

–ù–∞–ø—Ä–∏–º–µ—Ä:
‚Ä¢ –±–æ—Ç–Ω–∞—Ä–∏—Å—É–π –∫–æ—Ç–∞ –Ω–∞ –∫—Ä—ã—à–µ
‚Ä¢ –±–æ—Ç–Ω–∞—Ä–∏—Å—É–π –∫—Ä–∞—Å–∏–≤—ã–π –∑–∞–∫–∞—Ç –Ω–∞–¥ –æ–∫–µ–∞–Ω–æ–º
```

### **–ï—Å–ª–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–µ —É–¥–∞–ª–∞—Å—å:**
```
‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è: '–ø—Ä–æ–º–ø—Ç'
–í–æ–∑–º–æ–∂–Ω–æ, —Å–µ—Ä–≤–∏—Å –ø–µ—Ä–µ–≥—Ä—É–∂–µ–Ω. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.
```

### **–ï—Å–ª–∏ cooldown –∞–∫—Ç–∏–≤–µ–Ω:**
```
[–ò–ó–û–ë–†–ê–ñ–ï–ù–ò–ï-–¢–†–ò–ì–ì–ï–†] Cooldown –¥–ª—è —á–∞—Ç–∞ 123, –Ω–µ —Ä–µ–∞–≥–∏—Ä—É–µ–º.
```

## üìà **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:**

- –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –ª–æ–≥–∏—Ä—É—é—Ç—Å—è —Å –≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –º–µ—Ç–∫–∞–º–∏
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç—Å—è –≤—Ä–µ–º—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
- –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—Å—è —Ä–∞–∑–º–µ—Ä –æ—á–µ—Ä–µ–¥–∏ Stable Horde
- –õ–æ–≥–∏—Ä—É—é—Ç—Å—è –æ—à–∏–±–∫–∏ –∏ —É—Å–ø–µ—à–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏

## üéØ **–ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**

### **–ü—Ä–æ—Å—Ç–æ–π –∑–∞–ø—Ä–æ—Å:**
```
User: –±–æ—Ç–Ω–∞—Ä–∏—Å—É–π –∫–æ—Ç–∞
Bot: üé® –ì–µ–Ω–µ—Ä–∏—Ä—É—é –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ: '–∫–æ—Ç–∞'
     ‚è≥ –≠—Ç–æ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å 1-5 –º–∏–Ω—É—Ç...
     [–≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è]
     üñºÔ∏è [–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–æ—Ç–∞]
```

### **–°–ª–æ–∂–Ω—ã–π –∑–∞–ø—Ä–æ—Å:**
```
User: –±–æ—Ç–Ω–∞—Ä–∏—Å—É–π –∫–∏–±–µ—Ä–ø–∞–Ω–∫ –≥–æ—Ä–æ–¥ —Å –Ω–µ–æ–Ω–æ–≤—ã–º–∏ –æ–≥–Ω—è–º–∏
Bot: üé® –ì–µ–Ω–µ—Ä–∏—Ä—É—é –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ: '–∫–∏–±–µ—Ä–ø–∞–Ω–∫ –≥–æ—Ä–æ–¥ —Å –Ω–µ–æ–Ω–æ–≤—ã–º–∏ –æ–≥–Ω—è–º–∏'
     ‚è≥ –≠—Ç–æ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å 1-5 –º–∏–Ω—É—Ç...
     [–≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è]
     üñºÔ∏è [–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–∏–±–µ—Ä–ø–∞–Ω–∫ –≥–æ—Ä–æ–¥–∞]
```

---

**–ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!** üéâ –¢–µ–ø–µ—Ä—å –≤–∞—à –±–æ—Ç –º–æ–∂–µ—Ç –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø—Ä—è–º–æ –≤ –≥—Ä—É–ø–ø–∞—Ö! 