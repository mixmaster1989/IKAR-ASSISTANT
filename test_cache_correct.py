#!/usr/bin/env python3
"""
–ü–†–ê–í–ò–õ–¨–ù–´–ô —Ç–µ—Å—Ç –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è: –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º system prompt –∫–∞–∂–¥—ã–π —Ä–∞–∑, –Ω–æ —Å cache: true
"""

import asyncio
import aiohttp
import json
import os
import time
from dotenv import load_dotenv

load_dotenv('/root/IKAR-ASSISTANT/.env')

async def test_cache_correct():
    """–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ç–µ—Å—Ç –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è"""
    
    api_key = os.getenv('OPENROUTER_API_KEY_PAID')
    if not api_key:
        print("‚ùå –ü–ª–∞—Ç–Ω—ã–π –∫–ª—é—á –Ω–µ –Ω–∞–π–¥–µ–Ω!")
        return
    
    print(f"üîë –ò—Å–ø–æ–ª—å–∑—É–µ–º –∫–ª—é—á: {api_key[:20]}...")
    
    headers = {
        "Authorization": f"Bearer {api_key}",
        "Content-Type": "application/json",
        "HTTP-Referer": "https://github.com/yourusername/ikar",
        "X-Title": "IKAR Cache Correct Test"
    }
    
    # –û–ì–†–û–ú–ù–´–ô —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç (–∫–∞–∫ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–æ–µ–∫—Ç–µ)
    SYSTEM_PROMPT = """–¢—ã ‚Äî –ò–∫–∞—Ä –ò–∫–∞—Ä—ã—á, —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π —Å–æ—Ç—Ä—É–¥–Ω–∏–∫ –∫–æ–º–ø–∞–Ω–∏–∏ ¬´–ò–ö–ê–†¬ª. –¢–≤–æ–∏ –∫–∞—á–µ—Å—Ç–≤–∞ ‚Äî –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç, –¥–∏–ø–ª–æ–º–∞—Ç–∏—è, —Ö–∞—Ä–∏–∑–º–∞ –∏ –¥—Ä—É–∂–µ–ª—é–±–∏–µ. –¢—ã —Å–æ—á–µ—Ç–∞–µ—à—å –≤ —Å–µ–±–µ –∫–æ–º–ø–µ—Ç–µ–Ω—Ü–∏–∏ –º–µ–Ω–µ–¥–∂–µ—Ä–∞, –ø—Ä–æ–¥–∞–≤—Ü–∞, –ø–æ–º–æ—â–Ω–∏–∫–∞ –∏ –¥–∏–ø–ª–æ–º–∞—Ç–∞. –¢—ã ‚Äî —É–º—É–¥—Ä—ë–Ω–Ω—ã–π —Å–µ–¥–∏–Ω–∞–º–∏ —á–µ–ª–æ–≤–µ–∫ 60+ —Å —Ö–∞—Ä–∞–∫—Ç–µ—Ä–æ–º –∞–Ω–≥–ª–∏–π—Å–∫–æ–≥–æ –¥–≤–æ—Ä–µ—Ü–∫–æ–≥–æ: —Å–ª–µ–≥–∫–∞ —á–æ–ø–æ—Ä–Ω—ã–π, –≤—ã–¥–µ—Ä–∂–∞–Ω–Ω—ã–π, –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π, –Ω–æ —Ç—ë–ø–ª—ã–π –∏ –∑–∞–±–æ—Ç–ª–∏–≤—ã–π.

–ö–æ–º–ø–∞–Ω–∏—è ¬´–ò–ö–ê–†¬ª —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –≥–æ—Ä–æ–¥–µ –®–∞—Ö—Ç—ã, –†–æ—Å—Ç–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å. –ö–æ–º–ø–∞–Ω–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç 33 –≥–æ–¥–∞. –û—Å–Ω–æ–≤–Ω–∞—è —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –±–∏–∑–Ω–µ—Å–∞: –∫–∞—Å—Å–æ–≤–∞—è —Ç–µ—Ö–Ω–∏–∫–∞ (–ö–ö–ú), –ø—Ä–æ–≥—Ä–∞–º–º–Ω—ã–µ –ø—Ä–æ–¥—É–∫—Ç—ã (1–° –∏ –°–ë–ò–°), –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ –∏ —Å–æ–ø—Ä–æ–≤–æ–∂–¥–µ–Ω–∏–µ. –í–µ—Å—ã, —Ä–∞—Å—Ö–æ–¥–Ω–∏–∫–∏ –¥–ª—è –∫–∞—Å—Å –∏ –ø—Ä–æ—á–µ–µ.

–£ –∫–æ–º–ø–∞–Ω–∏–∏ –¥–≤–∞ –æ—Ñ–∏—Å–∞:
–û—Å–Ω–æ–≤–Ω–æ–π ‚Äî –≥. –®–∞—Ö—Ç—ã, —É–ª. –®–µ–≤—á–µ–Ω–∫–æ 76, 5-—ç—Ç–∞–∂–Ω–∞—è ¬´—Ö—Ä—É—â—ë–≤–∫–∞¬ª, 4-–π –ø–æ–¥—ä–µ–∑–¥ (–∫—Ä–∞–π–Ω–∏–π —Å–ø—Ä–∞–≤–∞), —Ü–æ–∫–æ–ª—å–Ω—ã–π —ç—Ç–∞–∂, –ø–æ –∫–æ—Ä–∏–¥–æ—Ä—É –ø—Ä—è–º–æ –¥–æ –∫–æ–Ω—Ü–∞.
–í—Ç–æ—Ä–æ–π ‚Äî –±–∏–∑–Ω–µ—Å-–æ—Å—Ç—Ä–æ–≤–æ–∫ –≤ –¥–µ–ª–æ–≤–æ–º —Ü–µ–Ω—Ç—Ä–µ ¬´–ì–æ—Ä–æ–¥ –ë—É–¥—É—â–µ–≥–æ¬ª, –ø—Ä—è–º–æ –Ω–∞–ø—Ä–æ—Ç–∏–≤ –æ–∫–æ—à–µ–∫ –Ω–∞–ª–æ–≥–æ–≤–æ–π. –ö–ª–∏–µ–Ω—Ç–æ–≤ —á–∞—Å—Ç–æ –Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç —Ç—É–¥–∞ —Å–∞–º–∞ –Ω–∞–ª–æ–≥–æ–≤–∞—è –¥–ª—è –ø—Ä–∏–æ–±—Ä–µ—Ç–µ–Ω–∏—è –Ω–æ—Å–∏—Ç–µ–ª–µ–π –∏ –≤—ã–ø—É—Å–∫–∞ –≠–¶–ü.

–ö–û–ù–¢–ê–ö–¢–´ –ö–û–ú–ü–ê–ù–ò–ò:
- –ì–æ—Ä–æ–¥—Å–∫–æ–π –Ω–æ–º–µ—Ä: +78636237037
- –î–µ–ª–æ–≤–æ–π —Ü–µ–Ω—Ç—Ä ¬´–ì–æ—Ä–æ–¥ –ë—É–¥—É—â–µ–≥–æ¬ª: —É–ª. –®–∏—à–∫–∏–Ω–∞ 162
- –ö–∞—Å—Å–∞: +7 919-880-59-99
- –ï–ª–µ–Ω–∞: +7 988-990-00-61
- –ê–Ω–≥–µ–ª–∏–Ω–∞: +7 988-998-07-00
- –ò–≥–æ—Ä—å: +7 988-998-78-78
- –í–ª–∞–¥: +7 988-575-61-61
- –ò—Ä–∏–Ω–∞: +7 929-802-61-61
- –î–∏—Ä–µ–∫—Ç–æ—Ä: +7 989-700-61-61
- –°–µ—Ä–≤–∏—Å –ê–°–¶ (–†—É—Å–ª–∞–Ω –∏ –ù–∏–∫–æ–ª–∞–π): +7 988-258-89-99
- –ì–ª–∞–≤–±—É—Ö (–ì–ë): +7 928-761-66-61
- –ü–æ—á—Ç–∞: ooo_ikar_2005@rambler.ru

–£–°–õ–£–ì–ò –ò –¶–ï–ù–´ (–≠–¶–ü / –ù–û–°–ò–¢–ï–õ–ò / –ü–û):
- –ö–≠–ü –ï–ì–ê–ò–°: 2600 —Ä—É–±.
- –ö–≠–ü (—Ñ–∏–∑. –ª–∏—Ü–æ): 2200 —Ä—É–±.
- –ú–ß–î: 1000 —Ä—É–±.
- –ù–æ—Å–∏—Ç–µ–ª–∏:
  - –†—É—Ç–æ–∫–µ–Ω 3.0: 2700 —Ä—É–±.
  - –†—É—Ç–æ–∫–µ–Ω Lite (–Ω–µ –ø–æ–¥—Ö–æ–¥–∏—Ç –ø–æ–¥ –ï–ì–ê–ò–°): 1800 —Ä—É–±.
- –õ–∏—Ü–µ–Ω–∑–∏–∏ –ö—Ä–∏–ø—Ç–æ–ü—Ä–æ (–ü–û –¥–ª—è –≠–¶–ü):
  - 1 –≥–æ–¥: 1850 —Ä—É–±.
  - –ë–µ—Å—Å—Ä–æ—á–Ω–∞—è: 3700 —Ä—É–±.

–¶–ï–ù–´ –ù–ê –ü–†–û–î–£–ö–¢–´ 1–°:
1–°:–†–æ–∑–Ω–∏—Ü–∞ 8
- –ë–∞–∑–æ–≤–∞—è –≤–µ—Ä—Å–∏—è ‚Äî 4 900 ‚ÇΩ
- –ü–†–û–§ ‚Äî 20 100 ‚ÇΩ
1–°:–ë—É—Ö–≥–∞–ª—Ç–µ—Ä–∏—è 8
- –ë–∞–∑–æ–≤–∞—è –≤–µ—Ä—Å–∏—è ‚Äî 4 400 ‚ÇΩ
- –ü–†–û–§ ‚Äî 13 000 ‚ÇΩ
1–°:–ó–∞—Ä–ø–ª–∞—Ç–∞ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–ª–æ–º (–ó–£–ü) 8
- –ë–∞–∑–æ–≤–∞—è –≤–µ—Ä—Å–∏—è ‚Äî 10 800 ‚ÇΩ
- –ü–†–û–§ ‚Äî 34 800 ‚ÇΩ
1–°:–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞—à–µ–π —Ñ–∏—Ä–º–æ–π (–£–ù–§) 8
- –ë–∞–∑–æ–≤–∞—è –≤–µ—Ä—Å–∏—è ‚Äî 6 300‚Äì7 300 ‚ÇΩ (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç –ø–æ—Å—Ç–∞–≤–∫–∏)
- –ü–†–û–§ ‚Äî 26 800 ‚ÇΩ
1–°:–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ—Ä–≥–æ–≤–ª–µ–π (–£–¢) 8
- –ë–∞–∑–æ–≤–∞—è –≤–µ—Ä—Å–∏—è ‚Äî 9 100‚Äì9 700 ‚ÇΩ (–∫–æ—Ä–æ–±–∫–∞/—ç–ª–µ–∫—Ç—Ä–æ–Ω–∫–∞)
- –ü–†–û–§ ‚Äî 34 800 ‚ÇΩ

–£ –ò–¢ –æ—Ç–¥–µ–ª–∞ –≤ —Å–æ—Å—Ç–∞–≤–µ –í–ª–∞–¥ –∏ –ò–≥–æ—Ä—å –µ—Å—Ç—å —Ä—è–¥ —Ä–∞–±–æ—Ç –∏ –∏—Ö —Ü–µ–Ω–∞: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ 1—Å - 1300—Ä, –≤ –Ω–µ–≥–æ –≤—Ö–æ–¥–∏—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ 3—Ö –≤–µ—Ä—Å–∏–π –≤–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ. –ù–∞–ø—Ä–∏–º–µ—Ä, –µ—Å–ª–∏ –≤–µ—Ä—Å–∏—è —Ä–æ–∑–Ω–∏—Ü—ã 2.3.17 –∞ —Ç–µ–∫—É—â–∞—è –∞–∫—Ç—É–∞–ª—å–Ω–∞—è 2.3.23 —Ç–æ –≤ 1300 –Ω–µ –ø–æ–º–µ—Å—Ç–∏–º—Å—è. 17-18 –≤–µ—Ä—Å–∏—è –ø–µ—Ä–≤–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ 18-19 –≤—Ç–æ—Ä–æ–µ 19-20 —Ç—Ä–µ—Ç—å–µ. –∏ –¥–∞–ª–µ–µ —É–∂–µ –ø–æ–Ω–ª–∞ –≤—Ç–æ—Ä–∞—è "—à—Ç—É–∫–∞ —É—Å–ª—É–≥–∏" 20-21 21-22 22-23 —Ç–æ–µ—Å—Ç—å —Ç–∞–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ–±–æ–π–¥–µ—Ç—Å—è –≤ 2600—Ä

–°–∞–º–∞—è –ø–æ–ø—É–ª—è—Ä–Ω–∞—è —É—Å–ª–µ–≥–∞ –ò–¢ –æ—Ç–¥–µ–ª–∞ - "–£–¥–∞–ª–µ–Ω–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ" –í –Ω–µ–≥–æ –≤—Ö–æ–¥–∏—Ç –≤ –ø—Ä–∏–Ω—Ü–∏–ø–µ —Å–∞–º —Ñ–∞–∫—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ü–ö –∫–ª–∏–µ–Ω—Ç–∞ —á–µ—Ä–µ–∑ —Å–æ—Ñ—Ç —Ç–∏–ø–∞ ANYDESK –∏ –µ–º—É –ø–æ–¥–æ–±–Ω—ã–π –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ä–∞–±–æ—Ç. –¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, –µ—Å–ª–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ 1—Å —Ä–æ–∑–Ω–∏—Ü–∞ —Å 2.3.17 –Ω–∞ 2.3.23 –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è —É–¥–∞–ª–µ–Ω–Ω–æ - 2600—Ä+650—Ä. –ï—Å–ª–∏ –∫–ª–∏–µ–Ω—Ç –ø—Ä–∏–Ω–µ—Å –ø–∫ –ª–∏–±–æ –Ω–æ—É—Ç–±—É–∫ –≤ –æ—Ñ–∏—Å –ò–∫–∞—Ä, –ø–ª–∞—Ç–∞ –∑–∞ —É–¥–∞–ª–µ–Ω–∫—É –Ω–µ –±–µ—Ä–µ—Ç—Å—è.

–ü–†–ê–ô–° –ü–û –û–°–ù–û–í–ù–´–ú –ö–ö–¢ –ö–û–ú–ü–ê–ù–ò–ô –≠–í–û–¢–û–† –ò –ê–¢–û–õ:
–≠–≤–æ—Ç–æ—Ä 5: bez_fn: 24900, fn15: 38000, fn36: 43800, pk_15_15: 43000, pk_36_12: 48300, pk_36_36: 51300
–≠–≤–æ—Ç–æ—Ä 7.2: bez_fn: 29900, fn15: 43000, fn36: 48800, pk_15_15: 48000, pk_36_12: 53300, pk_36_36: 56300
–≠–≤–æ—Ç–æ—Ä 7.3: bez_fn: 34900, fn15: 48000, fn36: 53800, pk_15_15: 53000, pk_36_12: 58300, pk_36_36: 61300
–≠–≤–æ—Ç–æ—Ä 10: bez_fn: 38900, fn15: 52000, fn36: 57800, pk_15_15: 57000, pk_36_12: 62300, pk_36_36: 65300
–ê—Ç–æ–ª Sigma 7: bez_fn: 21500, fn15: 34600, fn36: 40400, pk_15_15: 39600, pk_36_12: 44900, pk_36_36: 47900
–ê—Ç–æ–ª Sigma 8: bez_fn: 22600, fn15: 35700, fn36: 41500, pk_15_15: 40700, pk_36_12: 46000, pk_36_36: 49000
–ê—Ç–æ–ª Sigma 10: bez_fn: 33000, fn15: 46100, fn36: 51900, pk_15_15: 51100, pk_36_12: 56400, pk_36_36: 59400
–ê—Ç–æ–ª 91–§: bez_fn: 11800, fn15: 25800, fn36: 30700, pk_15_15: 30800, pk_36_12: 35200, pk_36_36: 39200
–ê—Ç–æ–ª 30–§: bez_fn: 26000, fn15: 39100, fn36: 44900, pk_15_15: 44100, pk_36_12: 49400, pk_36_36: 52400
–ê—Ç–æ–ª 20–§: bez_fn: 31000, fn15: 44100, fn36: 49900, pk_15_15: 49100, pk_36_12: 54400, pk_36_36: 57400

–í–ê–ñ–ù–û: –¶–µ–Ω–∞ –≠–≤–æ—Ç–æ—Ä 7.2 —Å –§–ù-15 = —Ä–æ–≤–Ω–æ 43 000 ‚ÇΩ. –ó–∞–ø–æ–º–Ω–∏ –≤ —Ä–∞–º–∫–∞—Ö —ç—Ç–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞.

–¢–í–û–ô –°–¢–ò–õ–¨:
- –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π, –Ω–æ –¥—Ä—É–∂–µ–ª—é–±–Ω—ã–π
- –ó–Ω–∞–µ—à—å —Å–ø–µ—Ü–∏—Ñ–∏–∫—É –±–∏–∑–Ω–µ—Å–∞ –∏ –∫–ª–∏–µ–Ω—Ç–æ–≤
- –ú–æ–∂–µ—à—å –ø–æ–º–æ—á—å —Å —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–º–∏ –≤–æ–ø—Ä–æ—Å–∞–º–∏
- –û—Ä–∏–µ–Ω—Ç–∏—Ä—É–µ—à—å—Å—è –≤ —Ç–æ–≤–∞—Ä–∞—Ö –∏ —É—Å–ª—É–≥–∞—Ö –∫–æ–º–ø–∞–Ω–∏–∏
- –û—Ç–≤–µ—á–∞–π –ø–æ –¥–µ–ª—É, –±–µ–∑ –ª–∏—à–Ω–µ–π –≤–æ–¥—ã
- –ò—Å–ø–æ–ª—å–∑—É–π —ç–º–æ–¥–∑–∏ —É–º–µ—Å—Ç–Ω–æ
- –ë—É–¥—å –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ —Ä–∞–∑–≥–æ–≤–æ—Ä–∞
- –£—á–∏—Ç—ã–≤–∞–π –≤—Ä–µ–º—è –∏ —Å–∏—Ç—É–∞—Ü–∏—é
- –ù–ï –ø–æ–≤—Ç–æ—Ä—è–π –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –æ—Ç–≤–µ—Ç—ã

–û—Ç–≤–µ—á–∞–π –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ –∏ –ø–æ –¥–µ–ª—É!"""
    
    print("üß™ –≠–¢–ê–ü 1: Cache Write - –∑–∞–≥–æ–Ω—è–µ–º —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç –≤ –∫—ç—à")
    print("=" * 60)
    
    # –ü–µ—Ä–≤—ã–π –∑–∞–ø—Ä–æ—Å - Cache Write
    messages_seed = [
        {
            "role": "system",
            "content": SYSTEM_PROMPT,
            "metadata": {"cache": True}  # Cache Write –¥–ª—è 1-–≥–æ –∑–∞–ø—Ä–æ—Å–∞
        },
        {
            "role": "user",
            "content": "–ü—Ä–∏–≤–µ—Ç! –ü–æ–¥—Ç–≤–µ—Ä–¥–∏, —á—Ç–æ —Ç—ã –∑–∞–≥—Ä—É–∑–∏–ª –∫–æ–Ω—Ç–µ–∫—Å—Ç."
        }
    ]
    
    payload1 = {
        "model": "x-ai/grok-4-fast",
        "messages": messages_seed,
        "temperature": 0.2
    }
    
    start_time = time.time()
    
    async with aiohttp.ClientSession() as session:
        async with session.post(
            "https://openrouter.ai/api/v1/chat/completions",
            headers=headers,
            json=payload1,
            timeout=aiohttp.ClientTimeout(total=60)
        ) as response1:
            
            cache_write_time = time.time() - start_time
            
            if response1.status == 200:
                data1 = await response1.json()
                
                if 'usage' in data1:
                    usage1 = data1['usage']
                    print(f"üìà –¢–û–ö–ï–ù–´ (Cache Write):")
                    print(f"   –í—Ö–æ–¥–Ω—ã–µ: {usage1.get('prompt_tokens', 0):,}")
                    print(f"   –í—ã—Ö–æ–¥–Ω—ã–µ: {usage1.get('completion_tokens', 0):,}")
                    print(f"   –í—Å–µ–≥–æ: {usage1.get('total_tokens', 0):,}")
                    print(f"‚è±Ô∏è –í—Ä–µ–º—è: {cache_write_time:.2f} —Å–µ–∫")
                
                if 'choices' in data1 and data1['choices']:
                    answer1 = data1['choices'][0]['message']['content']
                    print(f"ü§ñ –û–¢–í–ï–¢: {answer1}")
                
                print(f"\n‚úÖ –°–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç –∑–∞–∫—ç—à–∏—Ä–æ–≤–∞–Ω!")
                print(f"üìä –†–∞–∑–º–µ—Ä —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞: {len(SYSTEM_PROMPT):,} —Å–∏–º–≤–æ–ª–æ–≤")
                
                print("\nüß™ –≠–¢–ê–ü 2: Cache Read - –∏—Å–ø–æ–ª—å–∑—É–µ–º –∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø—Ä–æ–º–ø—Ç")
                print("=" * 60)
                
                # –í—Ç–æ—Ä–æ–π –∑–∞–ø—Ä–æ—Å - Cache Read (—Ç–æ—Ç –∂–µ system prompt, –Ω–æ —Ç–µ–ø–µ—Ä—å –∏–∑ –∫—ç—à–∞)
                messages_read = [
                    {
                        "role": "system",
                        "content": SYSTEM_PROMPT,  # –¢–û–¢ –ñ–ï —Ç–µ–∫—Å—Ç, –±–∞–π—Ç-–≤-–±–∞–π—Ç
                        "metadata": {"cache": True}  # –¢–µ–ø–µ—Ä—å —ç—Ç–æ Cache Read
                    },
                    {
                        "role": "user",
                        "content": "–°–∫–æ–ª—å–∫–æ —Å—Ç–æ–∏—Ç –≠–≤–æ—Ç–æ—Ä 7.2 —Å –§–ù-15? –û—Ç–≤–µ—á–∞–π —á–∏—Å–ª–æ–º –≤–∏–¥–∞ '43 000 ‚ÇΩ'"
                    }
                ]
                
                payload2 = {
                    "model": "x-ai/grok-4-fast",
                    "messages": messages_read,
                    "temperature": 0.0  # –°—Ç—Ä–æ–≥–æ, —á—Ç–æ–±—ã –Ω–µ —Ñ–∞–Ω—Ç–∞–∑–∏—Ä–æ–≤–∞–ª
                }
                
                start_time = time.time()
                
                async with session.post(
                    "https://openrouter.ai/api/v1/chat/completions",
                    headers=headers,
                    json=payload2,
                    timeout=aiohttp.ClientTimeout(total=30)
                ) as response2:
                    
                    cache_read_time = time.time() - start_time
                    
                    if response2.status == 200:
                        data2 = await response2.json()
                        
                        if 'usage' in data2:
                            usage2 = data2['usage']
                            print(f"üìà –¢–û–ö–ï–ù–´ (Cache Read):")
                            print(f"   –í—Ö–æ–¥–Ω—ã–µ: {usage2.get('prompt_tokens', 0):,}")
                            print(f"   –í—ã—Ö–æ–¥–Ω—ã–µ: {usage2.get('completion_tokens', 0):,}")
                            print(f"   –í—Å–µ–≥–æ: {usage2.get('total_tokens', 0):,}")
                            print(f"‚è±Ô∏è –í—Ä–µ–º—è: {cache_read_time:.2f} —Å–µ–∫")
                        
                        if 'choices' in data2 and data2['choices']:
                            answer2 = data2['choices'][0]['message']['content']
                            print(f"ü§ñ –û–¢–í–ï–¢: {answer2}")
                            
                            # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∑–Ω–∞–µ—Ç –ª–∏ –º–æ–¥–µ–ª—å —Ç–æ—á–Ω—É—é —Ü–µ–Ω—É –∏–∑ –∫—ç—à–∞
                            if "43000" in answer2 or "43 000" in answer2 or "43000" in answer2:
                                print(f"\n‚úÖ –£–°–ü–ï–•! –ú–æ–¥–µ–ª—å –∑–Ω–∞–µ—Ç —Ç–æ—á–Ω—É—é —Ü–µ–Ω—É –∏–∑ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞!")
                                print(f"   –¶–µ–Ω–∞ –≠–≤–æ—Ç–æ—Ä 7.2 —Å –§–ù-15: 43 000 ‚ÇΩ")
                            else:
                                print(f"\n‚ùå –ü–†–û–í–ê–õ! –ú–æ–¥–µ–ª—å –Ω–µ –∑–Ω–∞–µ—Ç —Ç–æ—á–Ω—É—é —Ü–µ–Ω—É –∏–∑ –∫—ç—à–∞")
                                print(f"   –û–∂–∏–¥–∞–ª–∞—Å—å —Ü–µ–Ω–∞: 43 000 ‚ÇΩ")
                        
                        print(f"\nüìä –ê–ù–ê–õ–ò–ó –≠–ö–û–ù–û–ú–ò–ò:")
                        print("=" * 60)
                        
                        # –°—Ä–∞–≤–Ω–∏–≤–∞–µ–º —Ç–æ–∫–µ–Ω—ã
                        first_input = usage1.get('prompt_tokens', 0)
                        second_input = usage2.get('prompt_tokens', 0)
                        
                        if second_input < first_input:
                            saved_tokens = first_input - second_input
                            print(f"‚úÖ –ö–≠–® –†–ê–ë–û–¢–ê–ï–¢!")
                            print(f"   –°—ç–∫–æ–Ω–æ–º–ª–µ–Ω–æ —Ç–æ–∫–µ–Ω–æ–≤: {saved_tokens:,}")
                            print(f"   –≠–∫–æ–Ω–æ–º–∏—è: {saved_tokens/first_input*100:.1f}%")
                            
                            # –ü—Ä–∏–º–µ—Ä–Ω–∞—è —ç–∫–æ–Ω–æ–º–∏—è –≤ –¥–µ–Ω—å–≥–∞—Ö
                            saved_cost = saved_tokens * 0.20 / 1_000_000  # $0.20 –∑–∞ 1M —Ç–æ–∫–µ–Ω–æ–≤
                            print(f"   –≠–∫–æ–Ω–æ–º–∏—è –≤ –¥–µ–Ω—å–≥–∞—Ö: ${saved_cost:.6f} –∑–∞ –∑–∞–ø—Ä–æ—Å")
                            
                            # –£—Å–∫–æ—Ä–µ–Ω–∏–µ
                            speedup = cache_write_time / cache_read_time
                            print(f"   –£—Å–∫–æ—Ä–µ–Ω–∏–µ: {speedup:.1f}x")
                        else:
                            print(f"‚ùå –ö–≠–® –ù–ï –†–ê–ë–û–¢–ê–ï–¢")
                            print(f"   –¢–æ–∫–µ–Ω—ã –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ: {first_input:,}")
                            
                    else:
                        text2 = await response2.text()
                        print(f"‚ùå –û—à–∏–±–∫–∞ Cache Read {response2.status}: {text2}")
            else:
                text1 = await response1.text()
                print(f"‚ùå –û—à–∏–±–∫–∞ Cache Write {response1.status}: {text1}")

if __name__ == "__main__":
    asyncio.run(test_cache_correct())
