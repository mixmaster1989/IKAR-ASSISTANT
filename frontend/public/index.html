<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¶–µ–Ω—Ç—Ä —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è | IKAR Admin</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        body { background: #181825; color: #e0e0e0; font-family: 'JetBrains Mono', 'Roboto', monospace; }
        .container { max-width: 800px; margin: 40px auto; background: #232336; border-radius: 12px; box-shadow: 0 2px 16px #0004; padding: 32px; }
        textarea { width: 100%; min-height: 100px; background: #181825; color: #e0e0e0; border: 1px solid #444; border-radius: 6px; padding: 8px; font-family: inherit; }
        label { font-weight: bold; margin-bottom: 4px; display: block; }
        button { background: #7c3aed; color: #fff; border: none; border-radius: 6px; padding: 10px 24px; font-size: 1rem; cursor: pointer; margin-top: 12px; }
        button:disabled { background: #444; }
        .status { margin-top: 12px; font-size: 0.95em; }
        .select-func { margin-bottom: 18px; }
        .tabs { display: flex; gap: 12px; margin-bottom: 24px; }
        .tab { padding: 8px 18px; border-radius: 8px 8px 0 0; background: #232336; color: #bbb; cursor: pointer; border: 1px solid #232336; border-bottom: none; }
        .tab.active { background: #181825; color: #fff; border: 1px solid #7c3aed; border-bottom: none; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .triggers-list, .autoposts-list { margin: 0 0 16px 0; padding: 0; list-style: none; }
        .triggers-list li, .autoposts-list li { background: #232336; border: 1px solid #333; border-radius: 6px; margin-bottom: 8px; padding: 8px 12px; display: flex; align-items: center; justify-content: space-between; }
        .triggers-list .trigger-text, .autoposts-list .autopost-text { flex: 1; }
        .triggers-list button, .autoposts-list button { margin-left: 10px; padding: 4px 12px; font-size: 0.95em; }
        .form-inline { display: flex; gap: 8px; align-items: center; margin-bottom: 12px; }
        .form-inline input, .form-inline textarea { min-width: 0; }
        table.groups-table, table.logs-table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        table.groups-table th, table.groups-table td, table.logs-table th, table.logs-table td { border: 1px solid #333; padding: 6px 8px; text-align: left; }
        table.groups-table th, table.logs-table th { background: #232336; }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π */
        .image-generator { max-width: 600px; }
        .form-block { background: #232336; padding: 20px; border-radius: 10px; margin-bottom: 20px; }
        .form-row { display: flex; gap: 15px; margin-bottom: 15px; }
        .form-row > div { flex: 1; }
        .image-result { margin-top: 20px; }
        .generated-image { border-radius: 10px; box-shadow: 0 4px 8px rgba(0,0,0,0.3); max-width: 100%; }
        .image-info { background: #232336; padding: 15px; border-radius: 10px; margin-top: 10px; font-size: 0.9em; }
        .image-info p { margin: 5px 0; }
        select, input[type="number"] { background: #2a2a3e; border: 1px solid #444; color: #fff; padding: 8px; border-radius: 5px; width: 100%; }
        #image-prompt { min-height: 80px; resize: vertical; }
        table.groups-table td input { width: 90%; background: #181825; color: #e0e0e0; border: 1px solid #444; border-radius: 4px; padding: 2px 6px; font-family: inherit; }
        .group-title { font-weight: bold; margin-top: 18px; }
        .logs-filters { display: flex; gap: 8px; margin-bottom: 12px; flex-wrap: wrap; }
        .logs-filters input, .logs-filters select { background: #181825; color: #e0e0e0; border: 1px solid #444; border-radius: 4px; padding: 4px 8px; font-family: inherit; }
    </style>
</head>
<body>
    <div class="container">
        <h1>–¶–µ–Ω—Ç—Ä —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</h1>
        <div class="tabs">
            <div class="tab active" data-tab="prompts">–ü—Ä–æ–º–ø—Ç—ã</div>
            <div class="tab" data-tab="triggers">–¢—Ä–∏–≥–≥–µ—Ä—ã</div>
            <div class="tab" data-tab="autoposts">–ê–≤—Ç–æ–ø–æ—Å—Ç–∏–Ω–≥</div>
            <div class="tab" data-tab="groups">–ì—Ä—É–ø–ø—ã/–∏–º–µ–Ω–∞</div>
            <div class="tab" data-tab="images">–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</div>
            <div class="tab" data-tab="logs">–õ–æ–≥–∏</div>
        </div>
        <div id="tab-prompts" class="tab-content active">
            <div id="prompts-list"></div>
            <button id="save-all-prompts-btn" style="margin-top:20px;">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤—Å–µ</button>
            <button id="send-channel-36-btn" style="margin-top:20px; margin-left:12px; background:#10b981;">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–æ—Å—Ç –≤ 36,6¬∞</button>
            <div id="send-channel-36-log" class="status" style="white-space:pre-wrap; color:#f87171; margin-top:8px;"></div>
            <div id="save-status" class="status"></div>
        </div>
        <div id="tab-triggers" class="tab-content">
            <form id="trigger-add-form" class="form-inline">
                <input type="text" id="trigger-text" placeholder="–ö–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ –∏–ª–∏ —Ñ—Ä–∞–∑–∞" required>
                <input type="text" id="trigger-action" placeholder="–î–µ–π—Å—Ç–≤–∏–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)">
                <button type="submit">–î–æ–±–∞–≤–∏—Ç—å</button>
            </form>
            <ul class="triggers-list" id="triggers-list"></ul>
            <div id="triggers-status" class="status"></div>
        </div>
        <div id="tab-autoposts" class="tab-content">
            <form id="autopost-add-form" class="form-inline">
                <input type="text" id="autopost-text" placeholder="–¢–µ–∫—Å—Ç –∞–≤—Ç–æ–ø–æ—Å—Ç–∞" required>
                <input type="text" id="autopost-schedule" placeholder="–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ (cron/—á–∞—Å—ã)">
                <input type="text" id="autopost-group" placeholder="–ì—Ä—É–ø–ø–∞/–∫–∞–Ω–∞–ª">
                <button type="submit">–î–æ–±–∞–≤–∏—Ç—å</button>
            </form>
            <ul class="autoposts-list" id="autoposts-list"></ul>
            <div id="autoposts-status" class="status"></div>
        </div>
        <div id="tab-groups" class="tab-content">
            <div id="groups-status" class="status"></div>
            <div id="groups-list"></div>
        </div>
        <div id="tab-images" class="tab-content">
            <div class="image-generator">
                <h3>üé® –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (DeepAI)</h3>
                <form id="image-form" class="form-block">
                    <label for="image-prompt">–û–ø–∏—Å–∞–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:</label>
                    <textarea id="image-prompt" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –∫–∏–±–µ—Ä–ø–∞–Ω–∫ –∫–æ—Ç —Å –∫–æ—Ñ–µ, —Ü–∏—Ñ—Ä–æ–≤–æ–µ –∏—Å–∫—É—Å—Å—Ç–≤–æ" required></textarea>
                    
                    <label for="image-model">–ú–æ–¥–µ–ª—å:</label>
                    <select id="image-model">
                        <option value="text2img">Text to Image (–û—Å–Ω–æ–≤–Ω–∞—è)</option>
                        <option value="tor-sr">Super Resolution</option>
                        <option value="colorizer">Colorizer</option>
                        <option value="deepdream">DeepDream</option>
                        <option value="waifu2x">Waifu2x (–ê–Ω–∏–º–µ)</option>
                    </select>
                    
                    <div class="form-row">
                        <div>
                            <label for="image-width">–®–∏—Ä–∏–Ω–∞:</label>
                            <input type="number" id="image-width" value="512" min="256" max="1024" step="64">
                        </div>
                        <div>
                            <label for="image-height">–í—ã—Å–æ—Ç–∞:</label>
                            <input type="number" id="image-height" value="512" min="256" max="1024" step="64">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div>
                            <label for="image-steps">–®–∞–≥–æ–≤:</label>
                            <input type="number" id="image-steps" value="20" min="10" max="50">
                        </div>
                        <div>
                            <label for="image-guidance">Guidance Scale:</label>
                            <input type="number" id="image-guidance" value="7.5" min="1" max="20" step="0.5">
                        </div>
                    </div>
                    
                    <label for="image-negative">–ù–µ–≥–∞—Ç–∏–≤–Ω—ã–π –ø—Ä–æ–º–ø—Ç (—á—Ç–æ –Ω–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å):</label>
                    <input type="text" id="image-negative" placeholder="blurry, low quality, ugly">
                    
                    <button type="submit" id="generate-btn">üé® –ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</button>
                </form>
                
                <div id="image-status" class="status"></div>
                <div id="image-result" class="image-result"></div>
            </div>
        </div>
        <div id="tab-logs" class="tab-content">
            <div class="logs-filters">
                <input type="text" id="log-group" placeholder="–ì—Ä—É–ø–ø–∞">
                <input type="text" id="log-user" placeholder="–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å">
                <input type="text" id="log-type" placeholder="–¢–∏–ø">
                <input type="datetime-local" id="log-after" placeholder="–ü–æ—Å–ª–µ">
                <input type="datetime-local" id="log-before" placeholder="–î–æ">
                <button id="logs-filter-btn">–§–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å</button>
            </div>
            <div id="logs-status" class="status"></div>
            <div id="logs-list"></div>
        </div>
    </div>
    <script>
    // Tabs logic
    document.querySelectorAll('.tab').forEach(tab => {
        tab.addEventListener('click', function() {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(tc => tc.classList.remove('active'));
            tab.classList.add('active');
            document.getElementById('tab-' + tab.dataset.tab).classList.add('active');
        });
    });

    // PROMPTS UI
    const API_PROMPTS = "/api/admin/prompts";
    const promptsList = document.getElementById('prompts-list');
    const saveAllPromptsBtn = document.getElementById('save-all-prompts-btn');
    const saveStatus = document.getElementById('save-status');
    let promptsData = {};

    async function loadPrompts() {
        promptsList.innerHTML = '–ó–∞–≥—Ä—É–∑–∫–∞...';
        try {
            const res = await fetch(API_PROMPTS);
            if (!res.ok) throw new Error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏');
            promptsData = await res.json();
            renderPrompts(promptsData);
            saveStatus.textContent = '';
        } catch (e) {
            promptsList.innerHTML = '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ' + e.message;
        }
    }

    function renderPrompts(data) {
        let html = '';
        Object.entries(data).forEach(([key, value], idx) => {
            html += `<div class="prompt-block" style="margin-bottom:32px; padding:18px; background:#232336; border-radius:10px; border:1px solid #333;">
                <div style="font-weight:bold; font-size:1.1em; margin-bottom:8px;">${key}</div>
                <label for="system-prompt-${idx}">System Prompt</label>
                <textarea id="system-prompt-${idx}" data-key="${key}" data-type="system_prompt" style="margin-bottom:8px;">${value.system_prompt || ''}</textarea>
                <label for="user-prompt-${idx}">User Prompt</label>
                <textarea id="user-prompt-${idx}" data-key="${key}" data-type="user_prompt">${value.user_prompt || ''}</textarea>
            </div>`;
        });
        promptsList.innerHTML = html;
    }

    saveAllPromptsBtn.addEventListener('click', async function() {
        // –°–æ–±–∏—Ä–∞–µ–º –≤—Å–µ –∑–Ω–∞—á–µ–Ω–∏—è
        const newData = {};
        promptsList.querySelectorAll('textarea').forEach(textarea => {
            const key = textarea.getAttribute('data-key');
            const type = textarea.getAttribute('data-type');
            if (!newData[key]) newData[key] = {};
            newData[key][type] = textarea.value;
        });
        saveStatus.textContent = '–°–æ—Ö—Ä–∞–Ω—è—é...';
        try {
            const res = await fetch(API_PROMPTS, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(newData)
            });
            if (!res.ok) throw new Error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è');
            saveStatus.textContent = '‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ!';
            promptsData = newData;
        } catch (e) {
            saveStatus.textContent = '–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è: ' + e.message;
        }
    });

    const sendChannel36Btn = document.getElementById('send-channel-36-btn');
    const sendChannel36Log = document.getElementById('send-channel-36-log');
    sendChannel36Btn.addEventListener('click', async function() {
        sendChannel36Btn.disabled = true;
        sendChannel36Btn.textContent = '–û—Ç–ø—Ä–∞–≤–∫–∞...';
        saveStatus.textContent = '';
        sendChannel36Log.textContent = '';
        try {
            const res = await fetch('/api/admin/autonomous_channel_post', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' }
            });
            let text = await res.text();
            if (!res.ok) throw new Error(text);
            saveStatus.textContent = '‚úÖ –ü–æ—Å—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –≤ –∫–∞–Ω–∞–ª 36,6¬∞!';
            sendChannel36Log.textContent = text;
        } catch (e) {
            saveStatus.textContent = '–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏: ' + e.message;
            sendChannel36Log.textContent = e.stack || e;
        } finally {
            sendChannel36Btn.disabled = false;
            sendChannel36Btn.textContent = '–û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–æ—Å—Ç –≤ 36,6¬∞';
        }
    });

    // –ó–∞–≥—Ä—É–∂–∞—Ç—å –ø—Ä–æ–º–ø—Ç—ã –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –≤–∫–ª–∞–¥–∫–∏
    document.querySelector('.tab[data-tab="prompts"]').addEventListener('click', loadPrompts);
    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∑–∏—Ç—å –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
    if (document.querySelector('.tab[data-tab="prompts"]').classList.contains('active')) {
        loadPrompts();
    }

    // LOGS
    const API_LOGS = "/api/admin/logs";
    const logsStatus = document.getElementById('logs-status');
    const logsList = document.getElementById('logs-list');
    const logsFilterBtn = document.getElementById('logs-filter-btn');
    const logGroup = document.getElementById('log-group');
    const logUser = document.getElementById('log-user');
    const logType = document.getElementById('log-type');
    const logAfter = document.getElementById('log-after');
    const logBefore = document.getElementById('log-before');

    async function loadLogs() {
        logsStatus.textContent = '–ó–∞–≥—Ä—É–∑–∫–∞...';
        let url = API_LOGS + '?';
        if (logGroup.value) url += 'group=' + encodeURIComponent(logGroup.value) + '&';
        if (logUser.value) url += 'user=' + encodeURIComponent(logUser.value) + '&';
        if (logType.value) url += 'log_type=' + encodeURIComponent(logType.value) + '&';
        if (logAfter.value) url += 'after=' + encodeURIComponent(logAfter.value) + '&';
        if (logBefore.value) url += 'before=' + encodeURIComponent(logBefore.value) + '&';
        try {
            const res = await fetch(url);
            if (!res.ok) throw new Error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏');
            const data = await res.json();
            renderLogs(data);
            logsStatus.textContent = '';
        } catch (e) {
            logsStatus.textContent = '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ' + e.message;
        }
    }
    function renderLogs(logs) {
        if (!logs.length) {
            logsList.innerHTML = '<div>–ù–µ—Ç –ª–æ–≥–æ–≤ –ø–æ –≤—ã–±—Ä–∞–Ω–Ω—ã–º —Ñ–∏–ª—å—Ç—Ä–∞–º.</div>';
            return;
        }
        let html = '<table class="logs-table"><thead><tr><th>–í—Ä–µ–º—è</th><th>–ì—Ä—É–ø–ø–∞</th><th>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</th><th>–¢–∏–ø</th><th>–°–æ–æ–±—â–µ–Ω–∏–µ</th></tr></thead><tbody>';
        logs.forEach(log => {
            html += `<tr><td>${log.time || ''}</td><td>${log.group || ''}</td><td>${log.user || ''}</td><td>${log.type || ''}</td><td>${log.message || ''}</td></tr>`;
        });
        html += '</tbody></table>';
        logsList.innerHTML = html;
    }
    logsFilterBtn.addEventListener('click', function(e) {
        e.preventDefault();
        loadLogs();
    });
    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∂–∞—Ç—å –ª–æ–≥–∏ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –≤–∫–ª–∞–¥–∫–∏
    document.querySelector('.tab[data-tab="logs"]').addEventListener('click', loadLogs);

    // IMAGES GENERATOR
    const imageForm = document.getElementById('image-form');
    const imageStatus = document.getElementById('image-status');
    const imageResult = document.getElementById('image-result');
    const generateBtn = document.getElementById('generate-btn');

    imageForm.addEventListener('submit', async function(e) {
        e.preventDefault();
        
        const prompt = document.getElementById('image-prompt').value.trim();
        if (!prompt) {
            imageStatus.textContent = '–í–≤–µ–¥–∏—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è';
            return;
        }

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç–∞—Ç—É—Å –∑–∞–≥—Ä—É–∑–∫–∏
        generateBtn.disabled = true;
        generateBtn.textContent = 'üé® –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º...';
        imageStatus.textContent = '–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ Hugging Face –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å 3-10 —Å–µ–∫—É–Ω–¥...';
        imageResult.innerHTML = '';
        
        // –î–æ–±–∞–≤–ª—è–µ–º –∞–Ω–∏–º–∞—Ü–∏—é —Å—Ç–∞—Ç—É—Å–∞
        let statusDots = 0;
        let statusInterval;
        let timeoutId;
        
        statusInterval = setInterval(() => {
            statusDots = (statusDots % 3) + 1;
            const dots = '.'.repeat(statusDots);
            imageStatus.textContent = `üé® –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ Hugging Face${dots} (–º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å 3-10 —Å–µ–∫—É–Ω–¥)`;
        }, 1000);

        try {
            const requestData = {
                prompt: prompt,
                model: document.getElementById('image-model').value,
                width: parseInt(document.getElementById('image-width').value),
                height: parseInt(document.getElementById('image-height').value),
                num_inference_steps: parseInt(document.getElementById('image-steps').value),
                guidance_scale: parseFloat(document.getElementById('image-guidance').value)
            };

            const negativePrompt = document.getElementById('image-negative').value.trim();
            if (negativePrompt) {
                requestData.negative_prompt = negativePrompt;
            }

            console.log('üîÑ –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å:', requestData);

            const controller = new AbortController();
            timeoutId = setTimeout(() => controller.abort(), 600000); // 10 –º–∏–Ω—É—Ç —Ç–∞–π–º–∞—É—Ç

            const response = await fetch('/api/image/generate', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(requestData),
                signal: controller.signal
            });

            clearTimeout(timeoutId);

            console.log('üì• –ü–æ–ª—É—á–µ–Ω –æ—Ç–≤–µ—Ç:', response.status, response.statusText);

            const result = await response.json();
            console.log('üìã –î–∞–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç–∞:', result);

            if (response.ok && result.success) {
                console.log('‚úÖ –£—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ');
                imageStatus.textContent = '‚úÖ –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ!';
                
                imageResult.innerHTML = `
                    <img src="${result.url}" alt="${result.original_prompt}" class="generated-image">
                    <div class="image-info">
                        <p><strong>–û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –ø—Ä–æ–º–ø—Ç:</strong> ${result.original_prompt}</p>
                        <p><strong>–ê–Ω–≥–ª–∏–π—Å–∫–∏–π –ø—Ä–æ–º–ø—Ç:</strong> ${result.english_prompt}</p>
                        <p><strong>–ú–æ–¥–µ–ª—å:</strong> ${result.model}</p>
                        <p><strong>–†–∞–∑–º–µ—Ä:</strong> ${result.size}</p>
                        <p><strong>–§–∞–π–ª:</strong> <a href="${result.url}" target="_blank">${result.filename}</a></p>
                    </div>
                `;
            } else {
                console.log('‚ùå –û—à–∏–±–∫–∞ –≤ –æ—Ç–≤–µ—Ç–µ:', result);
                const error = result.detail || result.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞';
                imageStatus.textContent = `‚ùå –û—à–∏–±–∫–∞: ${error}`;
            }

        } catch (error) {
            console.log('‚ùå –ò—Å–∫–ª—é—á–µ–Ω–∏–µ:', error);
            if (error.name === 'AbortError') {
                imageStatus.textContent = `‚ùå –¢–∞–π–º–∞—É—Ç: –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∑–∞–Ω—è–ª–∞ –±–æ–ª—å—à–µ 10 –º–∏–Ω—É—Ç`;
            } else {
                imageStatus.textContent = `‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ${error.message}`;
            }
        } finally {
            console.log('üîÑ –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–Ω–æ–ø–∫—É');
            clearTimeout(timeoutId);
            clearInterval(statusInterval);
            generateBtn.disabled = false;
            generateBtn.textContent = 'üé® –ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ';
        }
    });

    // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –≤–∫–ª–∞–¥–∫–∏
    document.querySelector('.tab[data-tab="images"]').addEventListener('click', async function() {
        try {
            const response = await fetch('/api/image/models');
            const data = await response.json();
            
            if (response.ok && data.models) {
                const modelSelect = document.getElementById('image-model');
                modelSelect.innerHTML = '';
                
                Object.entries(data.models).forEach(([key, value]) => {
                    const option = document.createElement('option');
                    option.value = key;
                    option.textContent = key.replace('-', ' ').replace('_', ' ');
                    modelSelect.appendChild(option);
                });
            }
        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥–µ–ª–µ–π:', error);
        }
    });
    </script>
</body>
</html>
