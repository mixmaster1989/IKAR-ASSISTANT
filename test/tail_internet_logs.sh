#!/bin/bash
# üåê –ë—ã—Å—Ç—Ä—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ —Å–∏—Å—Ç–µ–º—ã –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-–∏–Ω—Ç–µ–ª–ª–µ–∫—Ç–∞

LOG_FILE="internet_intelligence.log"

echo "üåê –ü–†–û–°–ú–û–¢–† –õ–û–ì–û–í –°–ò–°–¢–ï–ú–´ –ò–ù–¢–ï–†–ù–ï–¢-–ò–ù–¢–ï–õ–õ–ï–ö–¢–ê"
echo "=================================================="

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ –ª–æ–≥–æ–≤
if [ ! -f "$LOG_FILE" ]; then
    echo "‚ùå –§–∞–π–ª –ª–æ–≥–æ–≤ $LOG_FILE –Ω–µ –Ω–∞–π–¥–µ–Ω"
    echo "üí° –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å–∏—Å—Ç–µ–º–∞ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-–∏–Ω—Ç–µ–ª–ª–µ–∫—Ç–∞ –±—ã–ª–∞ –∑–∞–ø—É—â–µ–Ω–∞"
    exit 1
fi

# –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ñ–∞–π–ª–µ
FILE_SIZE=$(stat -f%z "$LOG_FILE" 2>/dev/null || stat -c%s "$LOG_FILE" 2>/dev/null || echo "unknown")
FILE_MTIME=$(stat -f%Sm "$LOG_FILE" 2>/dev/null || stat -c%y "$LOG_FILE" 2>/dev/null || echo "unknown")

echo "üìÅ –§–∞–π–ª: $LOG_FILE"
echo "üìä –†–∞–∑–º–µ—Ä: $FILE_SIZE –±–∞–π—Ç"
echo "‚è∞ –ü–æ—Å–ª–µ–¥–Ω–µ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ: $FILE_MTIME"
echo ""

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∫–∞–∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —Å—Ç—Ä–æ–∫
show_last_lines() {
    echo "üìù –ü–û–°–õ–ï–î–ù–ò–ï 20 –ó–ê–ü–ò–°–ï–ô:"
    echo "=================================================="
    tail -n 20 "$LOG_FILE"
}

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∫–∞–∑–∞ –æ—à–∏–±–æ–∫
show_errors() {
    echo "‚ùå –ü–û–°–õ–ï–î–ù–ò–ï –û–®–ò–ë–ö–ò:"
    echo "=================================================="
    grep "ERROR" "$LOG_FILE" | tail -n 10
}

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∫–∞–∑–∞ –ø–æ–∏—Å–∫–æ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
show_search_requests() {
    echo "üîç –ü–û–°–õ–ï–î–ù–ò–ï –ü–û–ò–°–ö–û–í–´–ï –ó–ê–ü–†–û–°–´:"
    echo "=================================================="
    grep "üîç –ü–û–ò–°–ö–û–í–´–ô –ó–ê–ü–†–û–°" "$LOG_FILE" | tail -n 10
}

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∫–∞–∑–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
show_performance() {
    echo "‚ö° –ü–û–°–õ–ï–î–ù–ò–ï –ó–ê–ü–ò–°–ò –ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–ò:"
    echo "=================================================="
    grep "‚ö° –ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–¨" "$LOG_FILE" | tail -n 10
}

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∫–∞–∑–∞ Telegram –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π
show_telegram() {
    echo "üì± –ü–û–°–õ–ï–î–ù–ò–ï TELEGRAM –ò–ù–¢–ï–ì–†–ê–¶–ò–ò:"
    echo "=================================================="
    grep "üì± TELEGRAM –ò–ù–¢–ï–ì–†–ê–¶–ò–Ø" "$LOG_FILE" | tail -n 10
}

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
monitor_realtime() {
    echo "üîÑ –ú–û–ù–ò–¢–û–†–ò–ù–ì –í –†–ï–ê–õ–¨–ù–û–ú –í–†–ï–ú–ï–ù–ò (Ctrl+C –¥–ª—è –≤—ã—Ö–æ–¥–∞):"
    echo "=================================================="
    tail -f "$LOG_FILE"
}

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
show_stats() {
    echo "üìä –°–¢–ê–¢–ò–°–¢–ò–ö–ê –õ–û–ì–û–í:"
    echo "=================================================="
    
    TOTAL_LINES=$(wc -l < "$LOG_FILE")
    ERROR_COUNT=$(grep -c "ERROR" "$LOG_FILE" || echo "0")
    WARNING_COUNT=$(grep -c "WARNING" "$LOG_FILE" || echo "0")
    INFO_COUNT=$(grep -c "INFO" "$LOG_FILE" || echo "0")
    SEARCH_COUNT=$(grep -c "üîç –ü–û–ò–°–ö–û–í–´–ô –ó–ê–ü–†–û–°" "$LOG_FILE" || echo "0")
    TELEGRAM_COUNT=$(grep -c "üì± TELEGRAM –ò–ù–¢–ï–ì–†–ê–¶–ò–Ø" "$LOG_FILE" || echo "0")
    
    echo "üìà –í—Å–µ–≥–æ —Å—Ç—Ä–æ–∫: $TOTAL_LINES"
    echo "‚ùå –û—à–∏–±–æ–∫: $ERROR_COUNT"
    echo "‚ö†Ô∏è  –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π: $WARNING_COUNT"
    echo "‚ÑπÔ∏è  –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã—Ö: $INFO_COUNT"
    echo "üîç –ü–æ–∏—Å–∫–æ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤: $SEARCH_COUNT"
    echo "üì± Telegram –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π: $TELEGRAM_COUNT"
}

# –û—Å–Ω–æ–≤–Ω–æ–µ –º–µ–Ω—é
while true; do
    echo ""
    echo "üéÆ –ú–ï–ù–Æ –ü–†–û–°–ú–û–¢–†–ê –õ–û–ì–û–í:"
    echo "1. üìù –ü–æ—Å–ª–µ–¥–Ω–∏–µ –∑–∞–ø–∏—Å–∏"
    echo "2. ‚ùå –û—à–∏–±–∫–∏"
    echo "3. üîç –ü–æ–∏—Å–∫–æ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã"
    echo "4. ‚ö° –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å"
    echo "5. üì± Telegram –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏"
    echo "6. üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞"
    echo "7. üîÑ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏"
    echo "8. üîç –ü–æ–∏—Å–∫ –ø–æ –∫–ª—é—á–µ–≤–æ–º—É —Å–ª–æ–≤—É"
    echo "0. ‚ùå –í—ã—Ö–æ–¥"
    echo "----------------------------------------"
    
    read -p "–í—ã–±–µ—Ä–∏—Ç–µ –æ–ø—Ü–∏—é: " choice
    
    case $choice in
        1)
            show_last_lines
            ;;
        2)
            show_errors
            ;;
        3)
            show_search_requests
            ;;
        4)
            show_performance
            ;;
        5)
            show_telegram
            ;;
        6)
            show_stats
            ;;
        7)
            monitor_realtime
            ;;
        8)
            read -p "–í–≤–µ–¥–∏—Ç–µ –∫–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ –¥–ª—è –ø–æ–∏—Å–∫–∞: " keyword
            echo "üîç –ü–û–ò–°–ö –ü–û –ö–õ–Æ–ß–ï–í–û–ú–£ –°–õ–û–í–£ '$keyword':"
            echo "=================================================="
            grep "$keyword" "$LOG_FILE" | tail -n 20
            ;;
        0)
            echo "üëã –î–æ —Å–≤–∏–¥–∞–Ω–∏—è!"
            exit 0
            ;;
        *)
            echo "‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –≤—ã–±–æ—Ä"
            ;;
    esac
    
    echo ""
    read -p "–ù–∞–∂–º–∏—Ç–µ Enter –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è..."
done 