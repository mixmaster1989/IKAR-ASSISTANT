#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ª–æ–≥–æ–≤ –∏–Ω—ä–µ–∫—Ü–∏–∏ –ø–∞–º—è—Ç–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

echo "üß† –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ª–æ–≥–æ–≤ –∏–Ω—ä–µ–∫—Ü–∏–∏ –ø–∞–º—è—Ç–∏"
echo "=================================="
echo ""

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –ª–æ–≥-—Ñ–∞–π–ª–æ–≤
if [ -f "logs/chatumba.log" ]; then
    echo "üìÑ –ù–∞–π–¥–µ–Ω –æ—Å–Ω–æ–≤–Ω–æ–π –ª–æ–≥: logs/chatumba.log"
else
    echo "‚ùå –û—Å–Ω–æ–≤–Ω–æ–π –ª–æ–≥ –Ω–µ –Ω–∞–π–¥–µ–Ω"
fi

if [ -f "logs/memory.log" ]; then
    echo "üìÑ –ù–∞–π–¥–µ–Ω –ª–æ–≥ –ø–∞–º—è—Ç–∏: logs/memory.log"
else
    echo "‚ùå –õ–æ–≥ –ø–∞–º—è—Ç–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω"
fi

echo ""
echo "üîç –§–∏–ª—å—Ç—Ä—ã –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞:"
echo "1. –í—Å–µ –ª–æ–≥–∏ –∏–Ω—ä–µ–∫—Ü–∏–∏ –ø–∞–º—è—Ç–∏:"
echo "   tail -f logs/chatumba.log | grep -i '–∏–Ω—ä–µ–∫—Ü–∏—è\|–ø–∞–º—è—Ç—å\|memory'"
echo ""
echo "2. –¢–æ–ª—å–∫–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–∞–º—è—Ç–∏:"
echo "   tail -f logs/chatumba.log | grep -E '–ò–Ω—ä–µ–∫—Ü–∏—è –ø–∞–º—è—Ç–∏|–ü–∞–º—è—Ç—å –∏–Ω—ä–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∞|—á–∞–Ω–∫–æ–≤|—Ç–æ–∫–µ–Ω–æ–≤|—Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å'"
echo ""
echo "3. –û—à–∏–±–∫–∏ –ø–∞–º—è—Ç–∏:"
echo "   tail -f logs/chatumba.log | grep -i '–æ—à–∏–±–∫–∞.*–ø–∞–º—è—Ç—å\|error.*memory'"
echo ""
echo "4. –í—Å–µ –ª–æ–≥–∏ –ø–∞–º—è—Ç–∏:"
echo "   tail -f logs/memory.log"
echo ""

# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞–µ–º –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
echo "üöÄ –ó–∞–ø—É—Å–∫–∞–µ–º –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ª–æ–≥–æ–≤ –∏–Ω—ä–µ–∫—Ü–∏–∏ –ø–∞–º—è—Ç–∏..."
echo "–ù–∞–∂–º–∏—Ç–µ Ctrl+C –¥–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏"
echo ""

# –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –æ –ø–∞–º—è—Ç–∏
echo "üìã –ü–æ—Å–ª–µ–¥–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –æ –ø–∞–º—è—Ç–∏:"
if [ -f "logs/chatumba.log" ]; then
    echo "–ò–∑ chatumba.log:"
    tail -n 20 logs/chatumba.log | grep -i "–∏–Ω—ä–µ–∫—Ü–∏—è\|–ø–∞–º—è—Ç—å\|memory" || echo "   –ó–∞–ø–∏—Å–µ–π –æ –ø–∞–º—è—Ç–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ"
    echo ""
fi

if [ -f "logs/memory.log" ]; then
    echo "–ò–∑ memory.log:"
    tail -n 10 logs/memory.log || echo "   –õ–æ–≥ –ø–∞–º—è—Ç–∏ –ø—É—Å—Ç"
    echo ""
fi

# –ó–∞–ø—É—Å–∫–∞–µ–º –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
echo "üîÑ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏:"
echo "=================================="

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
monitor_memory_logs() {
    if [ -f "logs/chatumba.log" ]; then
        tail -f logs/chatumba.log | grep --line-buffered -E "–ò–Ω—ä–µ–∫—Ü–∏—è –ø–∞–º—è—Ç–∏|–ü–∞–º—è—Ç—å –∏–Ω—ä–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∞|—á–∞–Ω–∫–æ–≤|—Ç–æ–∫–µ–Ω–æ–≤|—Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å|memory_injector|collective_mind" &
    fi
    
    if [ -f "logs/memory.log" ]; then
        tail -f logs/memory.log &
    fi
    
    # –ñ–¥–µ–º —Å–∏–≥–Ω–∞–ª–∞ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è
    wait
}

# –ó–∞–ø—É—Å–∫–∞–µ–º –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
monitor_memory_logs 