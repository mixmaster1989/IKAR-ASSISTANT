import re

# –ß–∏—Ç–∞–µ–º —Ñ–∞–π–ª
with open('backend/api/telegram_polling.py', 'r', encoding='utf-8') as f:
    content = f.read()

# –ù–∞—Ö–æ–¥–∏–º –º–µ—Å—Ç–æ –ø–æ—Å–ª–µ –∫—Ä–∏–ø—Ç–æ–º–µ–º–æ–≤ –∏ –¥–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–π —ç—Ç–∞–ø
old_section = '''        await send_long_telegram_message(chat_id, f"üòÇ **–ö–†–ò–ü–¢–û–ú–ï–ú–´:**\\n{crypto_memes}", None)
        
        # –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ
        await send_telegram_message(chat_id, "‚úÖ –ö–†–ò–ü–¢–û–°–£–î –ó–ê–í–ï–†–®–Å–ù! üéâ –í—Å–µ –∞–Ω–∞–ª–∏–∑—ã –∏ –º–µ–º—ã –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω—ã –≤—ã—à–µ! üöÄ", None)'''

new_section = '''        await send_long_telegram_message(chat_id, f"üòÇ **–ö–†–ò–ü–¢–û–ú–ï–ú–´:**\\n{crypto_memes}", None)
        
        # 8. –¢–û–†–ì–û–í–´–ô –°–ò–ì–ù–ê–õ - –§–ò–ù–ê–õ–¨–ù–ê–Ø –°–î–ï–õ–ö–ê
        await send_telegram_message(chat_id, "üí∞ –§–æ—Ä–º–∏—Ä—É—é —Ç–æ—Ä–≥–æ–≤—ã–π —Å–∏–≥–Ω–∞–ª...", None)
        
        trading_prompt = f"""üí∞ –¢—ã ‚Äî –ü–†–û–§–ï–°–°–ò–û–ù–ê–õ–¨–ù–´–ô –¢–†–ï–ô–î–ï–†-–ê–ù–ê–õ–ò–¢–ò–ö! –≠–∫—Å–ø–µ—Ä—Ç –ø–æ —Ç–æ—Ä–≥–æ–≤—ã–º —Å–∏–≥–Ω–∞–ª–∞–º! üìä

üéØ –ù–∞ –æ—Å–Ω–æ–≤–µ –í–°–ï–• –∞–Ω–∞–ª–∏–∑–æ–≤ –≤—ã—à–µ, –¥–∞–π –ß–ï–¢–ö–£–Æ –¢–û–†–ì–û–í–£–Æ –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–Æ:

üìà **–ù–ê–ü–†–ê–í–õ–ï–ù–ò–ï:** LONG/SHORT/–û–ñ–ò–î–ê–ù–ò–ï
üíµ **–¶–ï–ù–ê –í–•–û–î–ê:** –ö–æ–Ω–∫—Ä–µ—Ç–Ω–∞—è —Ü–µ–Ω–∞ –∏–ª–∏ –¥–∏–∞–ø–∞–∑–æ–Ω
üéØ **TAKE PROFIT:** –¶–µ–ª–µ–≤—ã–µ —É—Ä–æ–≤–Ω–∏ (1-3 —Ü–µ–ª–∏)
üõë **STOP LOSS:** –£—Ä–æ–≤–µ–Ω—å —Å—Ç–æ–ø-–ª–æ—Å—Å–∞
‚è∞ **–¢–ê–ô–ú–§–†–ï–ô–ú:** –ö—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω–æ/—Å—Ä–µ–¥–Ω–µ—Å—Ä–æ—á–Ω–æ/–¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ
üìä **–†–ê–ó–ú–ï–† –ü–û–ó–ò–¶–ò–ò:** % –æ—Ç –¥–µ–ø–æ–∑–∏—Ç–∞
‚öñÔ∏è **–†–ò–°–ö/–ü–†–ò–ë–´–õ–¨:** –°–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ R/R

üî• –ë—É–¥—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º! –ù–∏–∫–∞–∫–∏—Ö "–≤–æ–∑–º–æ–∂–Ω–æ" –∏ "–º–æ–∂–µ—Ç –±—ã—Ç—å"!

üì∑ –ì—Ä–∞—Ñ–∏–∫: {image_description}

üêÇ –ë—ã—á–∏–π –∞–Ω–∞–ª–∏–∑: {bull_opinion}

üêª –ú–µ–¥–≤–µ–∂–∏–π –∞–Ω–∞–ª–∏–∑: {bear_opinion}

üìä –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑: {tech_analysis}

üåç –ú–∞–∫—Ä–æ–∞–Ω–∞–ª–∏–∑: {macro_analysis}

üì∞ –†—ã–Ω–æ—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ: {crypto_news}"""
        
        trading_signal = await llm_client.chat_completion(
            user_message=trading_prompt,
            system_prompt="üí∞ –¢—ã –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π —Ç—Ä–µ–π–¥–µ—Ä! –î–∞–≤–∞–π —á–µ—Ç–∫–∏–µ —Ç–æ—Ä–≥–æ–≤—ã–µ —Å–∏–≥–Ω–∞–ª—ã! –ù–∏–∫–∞–∫–∏—Ö —Ä–∞–∑–º—ã—Ç—ã—Ö —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–æ–∫! üìä",
            chat_history=[],
            model="deepseek/deepseek-r1-0528:free",
            max_tokens=1000
        )
        
        await send_long_telegram_message(chat_id, f"üí∞ **–¢–û–†–ì–û–í–´–ô –°–ò–ì–ù–ê–õ:**\\n{trading_signal}", None)
        
        # –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ
        await send_telegram_message(chat_id, "‚úÖ –ö–†–ò–ü–¢–û–°–£–î –ó–ê–í–ï–†–®–Å–ù! üéâ –¢–æ—Ä–≥–æ–≤—ã–π —Å–∏–≥–Ω–∞–ª –≥–æ—Ç–æ–≤! üí∞", None)'''

# –ó–∞–º–µ–Ω—è–µ–º
content = content.replace(old_section, new_section)

# –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –æ–±—Ä–∞—Ç–Ω–æ
with open('backend/api/telegram_polling.py', 'w', encoding='utf-8') as f:
    f.write(content)

print("–î–æ–±–∞–≤–ª–µ–Ω —ç—Ç–∞–ø —Ç–æ—Ä–≥–æ–≤–æ–≥–æ —Å–∏–≥–Ω–∞–ª–∞ –≤ –ö–†–ò–ü–¢–û–°–£–î!")